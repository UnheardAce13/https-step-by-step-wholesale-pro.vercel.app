/**
 * S.B.S.W.P 2.0 - PRODUCTION DEPLOYMENT CONFIGURATION
 * Enterprise-grade deployment with comprehensive monitoring for MARKET DOMINATION
 */

// Vercel deployment configuration
module.exports = {
  // Build configuration
  builds: [
    {
      src: 'package.json',
      use: '@vercel/next'
    }
  ],

  // Environment variables for production
  env: {
    NODE_ENV: 'production',
    NEXT_PUBLIC_APP_ENV: 'production',
    NEXT_PUBLIC_API_URL: 'https://api.sbswp.com',
    NEXT_PUBLIC_WS_URL: 'wss://ws.sbswp.com'
  },

  // Functions configuration
  functions: {
    'app/**/*.ts': {
      runtime: 'nodejs18.x',
      maxDuration: 30
    },
    'pages/api/**/*.ts': {
      runtime: 'nodejs18.x',
      maxDuration: 60
    }
  },

  // Headers for security and performance
  headers: [
    {
      source: '/(.*)',
      headers: [
        {
          key: 'X-Frame-Options',
          value: 'DENY'
        },
        {
          key: 'X-Content-Type-Options',
          value: 'nosniff'
        },
        {
          key: 'Referrer-Policy',
          value: 'strict-origin-when-cross-origin'
        },
        {
          key: 'Permissions-Policy',
          value: 'camera=(), microphone=(), geolocation=()'
        },
        {
          key: 'Content-Security-Policy',
          value: "default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https://js.stripe.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.openai.com https://api.docusign.net https://*.supabase.co wss://*.supabase.co; frame-src 'self' https://js.stripe.com;"
        }
      ]
    },
    {
      source: '/api/(.*)',
      headers: [
        {
          key: 'Access-Control-Allow-Origin',
          value: 'https://sbswp.com'
        },
        {
          key: 'Access-Control-Allow-Methods',
          value: 'GET, POST, PUT, DELETE, OPTIONS'
        },
        {
          key: 'Access-Control-Allow-Headers',
          value: 'Content-Type, Authorization'
        }
      ]
    }
  ],

  // Redirects for SEO and user experience
  redirects: [
    {
      source: '/',
      has: [
        {
          type: 'host',
          value: 'www.sbswp.com'
        }
      ],
      destination: 'https://sbswp.com',
      permanent: true
    },
    {
      source: '/login',
      destination: '/auth/signin',
      permanent: true
    }
  ],

  // Rewrites for API routing
  rewrites: [
    {
      source: '/api/v1/:path*',
      destination: '/api/:path*'
    }
  ],

  // Caching configuration
  caching: {
    // Cache static assets for 1 year
    '/images/**': {
      'Cache-Control': 'public, max-age=31536000, immutable'
    },
    // Cache API responses for 5 minutes
    '/api/**': {
      'Cache-Control': 'public, max-age=300, s-maxage=300'
    },
    // Cache pages for 1 hour
    '/**': {
      'Cache-Control': 'public, max-age=3600, s-maxage=3600'
    }
  },

  // Regions for optimal performance
  regions: ['iad1', 'sfo1', 'lhr1'],

  // GitHub integration
  github: {
    silent: true
  }
}